import nimAES

var ctx = initAES()
var key = "0123456789ABCDEF"
var text = readFile("beacon.exe")
if ctx.setEncodeKey(key):
    var offset = 0
    var counter: array[0..15, uint8]
    var nonce = cast[cstring](addr(counter[0]))
    counter.reset
    var out1 = ctx.cryptCTR(offset, nonce, text)
    writeFile("encryptedBeacon", out1)
    offset = 0
    counter.reset
    var out2 = ctx.cryptCTR(offset, nonce, out1)
    writeFile("decryptedBeacon", out2)